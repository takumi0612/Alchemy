<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALCHEMY ATELIER - ÂÆåÂÖ®Áâà</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Quattrocento:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Quattrocento', serif; overflow: hidden; background: #f4ece1; color: #3e2723; }
        .font-cinzel { font-family: 'Cinzel', serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d7ccc8; border-radius: 10px; }
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fade-in 0.4s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // „Ç¢„Ç§„Ç≥„É≥„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„ÅÆÂÆöÁæ©
        const LucideIcon = ({ name, size = 20, className = "" }) => {
            const iconRef = React.useRef(null);
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            });
            return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
        };

        // --- „Éá„Éº„ÇøÂÆöÁæ© („ÅÇ„Å™„Åü„ÅÆÂÖÉ„ÅÆ„Éá„Éº„Çø„Çí„Åù„ÅÆ„Åæ„Åæ‰ΩøÁî®) ---
        const RAW_MATERIALS = [
            { id: 'red_herb', name: 'Ëµ§„ÅÆËñ¨Ëçâ', basePrice: 40, icon: 'üåø' },
            { id: 'blue_herb', name: 'Èùí„ÅÆËñ¨Ëçâ', basePrice: 60, icon: 'üå±' },
            { id: 'monster_claw', name: 'È≠îÁâ©„ÅÆÁà™', basePrice: 150, icon: 'ü¶¥' },
            { id: 'magic_water', name: 'È≠îÂäõÊ∞¥', basePrice: 100, icon: 'üíß' },
        ];

        const CRAFTED_ITEMS = [
            { id: 'hp_potion', name: 'Áôí„ÇÑ„Åó„ÅÆ„Éù„Éº„Ç∑„Éß„É≥', sellPrice: 250, icon: 'üß™', recipe: { red_herb: 2, magic_water: 1 }, description: 'ÂÇ∑„ÇíÁôí„ÇÑ„ÅôÂü∫Êú¨„ÅÆËñ¨„ÄÇ' },
            { id: 'mp_potion', name: 'È≠îÂäõ„ÅÆ„Éù„Éº„Ç∑„Éß„É≥', sellPrice: 350, icon: '‚öóÔ∏è', recipe: { blue_herb: 2, magic_water: 1 }, description: 'È≠îÂäõ„ÇíÂõûÂæ©„Åï„Åõ„ÇãÈùí„ÅÑÈõ´„ÄÇ' },
            { id: 'strength_elixir', name: 'ÂâõÂäõ„ÅÆÈúäËñ¨', sellPrice: 800, icon: 'üç∑', recipe: { monster_claw: 1, red_herb: 1, magic_water: 1 }, description: '‰∏ÄÊôÇÁöÑ„Å´Á≠ãÂäõ„ÇíÂ§ßÂπÖ„Å´Âº∑Âåñ„Åô„Çã„ÄÇ' },
        ];

        const UPGRADES = [
            { id: 'cauldron_v2', name: 'ÈäÄ„ÅÆÈå¨ÈáëÈáú', cost: 1500, description: 'Èå¨ÈáëÊôÇ„ÅÆÊàêÂäüÂ†±ÈÖ¨„Åå10%„Ç¢„ÉÉ„Éó„Åó„Åæ„Åô„ÄÇ' },
            { id: 'shop_sign', name: 'È≠îÊ≥ï„ÅÆÁúãÊùø', cost: 800, description: 'Êù•ÂÆ¢Áéá„Åå‰∏äÊòá„Åó„Åæ„Åô„ÄÇ' },
        ];

        function App() {
            // --- Áä∂ÊÖãÁÆ°ÁêÜ („ÅÇ„Å™„Åü„ÅÆÂÖÉ„ÅÆ„É≠„Ç∏„ÉÉ„ÇØ) ---
            const [money, setMoney] = useState(1000);
            const [day, setDay] = useState(1);
            const [inventory, setInventory] = useState({ red_herb: 8, blue_herb: 5, monster_claw: 0, magic_water: 6, hp_potion: 0, mp_potion: 0, strength_elixir: 0 });
            const [marketPrices, setMarketPrices] = useState({});
            const [logs, setLogs] = useState([]);
            const [activeTab, setActiveTab] = useState('shop');
            const [reputation, setReputation] = useState(30);
            const [ownedUpgrades, setOwnedUpgrades] = useState([]);
            const [customerQueue, setCustomerQueue] = useState([]);
            const [stats, setStats] = useState({ totalSales: 0, craftedCount: 0 });

            const addLog = useCallback((msg, type = 'info') => {
                setLogs(prev => [{ id: Date.now(), msg, type, time: new Date().toLocaleTimeString() }, ...prev].slice(0, 30));
            }, []);

            // ‰æ°Ê†ºÊõ¥Êñ∞
            useEffect(() => {
                const newPrices = {};
                RAW_MATERIALS.forEach(item => {
                    const flux = 0.7 + Math.random() * 0.6;
                    newPrices[item.id] = Math.floor(item.basePrice * flux);
                });
                setMarketPrices(newPrices);
            }, [day]);

            // Êù•ÂÆ¢„Ç∑„Çπ„ÉÜ„É†
            useEffect(() => {
                const rate = ownedUpgrades.includes('shop_sign') ? 0.45 : 0.3;
                const interval = setInterval(() => {
                    if (Math.random() < rate + (reputation / 250)) {
                        const allPossible = [...RAW_MATERIALS, ...CRAFTED_ITEMS];
                        const wanted = allPossible[Math.floor(Math.random() * allPossible.length)];
                        setCustomerQueue(prev => [...prev, { id: Date.now(), want: wanted.id, name: `ÂÜíÈô∫ËÄÖ #${Math.floor(Math.random()*999)}` }]);
                    }
                }, 4500);
                return () => clearInterval(interval);
            }, [reputation, ownedUpgrades]);

            // Ë≤©Â£≤Âá¶ÁêÜ
            useEffect(() => {
                if (customerQueue.length > 0) {
                    const customer = customerQueue[0];
                    const timer = setTimeout(() => {
                        const itemData = [...RAW_MATERIALS, ...CRAFTED_ITEMS].find(i => i.id === customer.want);
                        if (inventory[customer.want] > 0) {
                            const price = itemData.sellPrice || Math.floor(itemData.basePrice * 1.5);
                            setInventory(prev => ({ ...prev, [customer.want]: prev[customer.want] - 1 }));
                            setMoney(prev => prev + price);
                            setReputation(prev => Math.min(prev + 0.8, 100));
                            setStats(prev => ({ ...prev, totalSales: prev.totalSales + price }));
                            addLog(`${customer.name}„Å´${itemData.name}„ÇíÂ£≤Âç¥„ÄÇÈáëË≤® ${price} ÊûöÂèóÈ†ò„ÄÇ`, 'success');
                        } else {
                            setReputation(prev => Math.max(prev - 1.5, 0));
                            addLog(`${customer.name}„ÅØÂ§±Êúõ„Åó„Å¶Â∏∞„Çä„Åæ„Åó„Åü...`, 'error');
                        }
                        setCustomerQueue(prev => prev.slice(1));
                    }, 2000);
                    return () => clearTimeout(timer);
                }
            }, [customerQueue, inventory, addLog]);

            const handleBuy = (itemId, amount) => {
                const cost = marketPrices[itemId] * amount;
                if (money >= cost) {
                    setMoney(m => m - cost);
                    setInventory(prev => ({ ...prev, [itemId]: prev[itemId] + amount }));
                    addLog(`${itemId} „Çí ${amount}ÂÄã ‰ªïÂÖ•„Çå„Åæ„Åó„Åü„ÄÇ`, 'buy');
                }
            };

            const handleCraft = (potionId) => {
                const potion = CRAFTED_ITEMS.find(p => p.id === potionId);
                const canCraft = Object.entries(potion.recipe).every(([id, count]) => inventory[id] >= count);
                if (canCraft) {
                    const newInv = { ...inventory };
                    Object.entries(potion.recipe).forEach(([id, count]) => newInv[id] -= count);
                    newInv[potionId] += 1;
                    setInventory(newInv);
                    setStats(s => ({ ...s, craftedCount: s.craftedCount + 1 }));
                    addLog(`${potion.name} „ÇíË™øÂêà„Åó„Åæ„Åó„ÅüÔºÅ`, 'craft');
                }
            };

            return (
                <div className="flex h-screen w-full">
                    {/* „Çµ„Ç§„Éâ„Éä„Éì */}
                    <aside className="w-64 bg-[#efe2d0] border-r-4 border-[#3e2723] flex flex-col shadow-2xl">
                        <div className="p-8 text-center border-b border-black/10">
                            <h1 className="text-2xl font-cinzel font-black text-amber-900">ALCHEMY</h1>
                        </div>
                        <nav className="flex-1 py-4">
                            {['shop', 'market', 'alchemy', 'stats'].map(tab => (
                                <button key={tab} onClick={() => setActiveTab(tab)} className={`w-full p-4 font-cinzel font-bold text-left px-8 ${activeTab === tab ? 'bg-amber-900 text-white' : 'text-amber-900/60'}`}>
                                    {tab.toUpperCase()}
                                </button>
                            ))}
                        </nav>
                        <div className="p-6 border-t border-black/10">
                            <p className="text-[10px] uppercase font-bold opacity-40">Gold</p>
                            <p className="text-2xl font-cinzel font-bold">üí∞ {money.toLocaleString()}</p>
                        </div>
                    </aside>

                    {/* „É°„Ç§„É≥„Ç®„É™„Ç¢ */}
                    <main className="flex-1 flex flex-col bg-[#fdfaf6] overflow-hidden">
                        <header className="h-20 border-b flex items-center justify-between px-10 bg-white/50">
                            <div className="flex gap-8 items-center">
                                <span className="font-cinzel font-bold text-2xl">Day {day}</span>
                                <span className="text-xs font-bold opacity-40 uppercase">Reputation: {reputation.toFixed(0)}%</span>
                            </div>
                            <button onClick={() => setDay(d => d + 1)} className="bg-amber-900 text-white px-8 py-2 font-cinzel font-bold hover:bg-black transition">Next Day</button>
                        </header>

                        <div className="flex-1 p-10 overflow-y-auto custom-scrollbar">
                            {activeTab === 'shop' && (
                                <div className="animate-in space-y-10">
                                    <div className="grid grid-cols-3 gap-6">
                                        {[...RAW_MATERIALS, ...CRAFTED_ITEMS].map(item => (
                                            <div key={item.id} className="bg-white p-6 border-2 border-amber-100 shadow-sm relative group">
                                                <span className="text-4xl">{item.icon}</span>
                                                <p className="text-xs font-bold opacity-40 mt-2">{item.name}</p>
                                                <p className="text-3xl font-cinzel font-black">{inventory[item.id] || 0}</p>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="space-y-4">
                                        <h3 className="font-cinzel font-bold text-amber-900/40 uppercase tracking-widest text-sm">Waiting Customers</h3>
                                        {customerQueue.map((c, i) => (
                                            <div key={c.id} className={`p-4 bg-white border-l-4 shadow-sm flex justify-between ${i===0?'border-amber-600':'border-slate-200 opacity-40'}`}>
                                                <span className="font-bold">{c.name}</span>
                                                <span className="bg-amber-50 px-3 py-1 text-xs font-bold border border-amber-200">Request: {c.want}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'market' && (
                                <div className="animate-in space-y-4">
                                    {RAW_MATERIALS.map(item => (
                                        <div key={item.id} className="bg-white p-6 border flex justify-between items-center group hover:border-amber-400 transition">
                                            <div className="flex items-center gap-4">
                                                <span className="text-4xl">{item.icon}</span>
                                                <span className="text-xl font-bold font-cinzel">{item.name} (G {marketPrices[item.id]})</span>
                                            </div>
                                            <div className="flex gap-2">
                                                <button onClick={() => handleBuy(item.id, 1)} className="border-2 border-amber-900 px-4 py-1 font-bold">x1</button>
                                                <button onClick={() => handleBuy(item.id, 10)} className="bg-amber-900 text-white px-4 py-1 font-bold">x10</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {activeTab === 'alchemy' && (
                                <div className="animate-in space-y-6">
                                    {CRAFTED_ITEMS.map(potion => {
                                        const can = Object.entries(potion.recipe).every(([id, count]) => inventory[id] >= count);
                                        return (
                                            <div key={potion.id} className={`p-8 border-2 transition ${can ? 'bg-white border-indigo-200' : 'bg-slate-50 opacity-60'}`}>
                                                <div className="flex justify-between items-center mb-6">
                                                    <div className="flex gap-4 items-center">
                                                        <span className="text-5xl">{potion.icon}</span>
                                                        <div>
                                                            <h3 className="text-xl font-cinzel font-black">{potion.name}</h3>
                                                            <p className="text-xs italic">{potion.description}</p>
                                                        </div>
                                                    </div>
                                                    <button onClick={() => handleCraft(potion.id)} disabled={!can} className={`px-8 py-3 font-cinzel font-bold ${can?'bg-indigo-900 text-white shadow-[4px_4px_0_#1e1b4b]':'bg-slate-200'}`}>Ë™øÂêà</button>
                                                </div>
                                                <div className="flex gap-4">
                                                    {Object.entries(potion.recipe).map(([id, count]) => (
                                                        <span key={id} className={`text-[10px] font-bold px-2 py-1 rounded border ${inventory[id]>=count?'bg-emerald-50 text-emerald-700':'bg-red-50 text-red-700'}`}>{id} x{count}</span>
                                                    ))}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}

                            {activeTab === 'stats' && (
                                <div className="animate-in space-y-8">
                                    <div className="grid grid-cols-2 gap-6">
                                        <div className="bg-white p-8 border-2 border-amber-100 shadow-xl">
                                            <p className="text-[10px] font-bold opacity-40 uppercase">Total Sales</p>
                                            <p className="text-4xl font-cinzel font-black">G {stats.totalSales}</p>
                                        </div>
                                        <div className="bg-white p-8 border-2 border-indigo-100 shadow-xl">
                                            <p className="text-[10px] font-bold opacity-40 uppercase">Crafted Count</p>
                                            <p className="text-4xl font-cinzel font-black">{stats.craftedCount} times</p>
                                        </div>
                                    </div>
                                    <div className="bg-amber-900/5 p-8 border-2 border-dashed border-amber-900/10">
                                        <h3 className="font-cinzel font-bold mb-4 uppercase">Atelier Upgrades</h3>
                                        <div className="grid grid-cols-2 gap-4">
                                            {UPGRADES.map(u => (
                                                <button key={u.id} disabled={ownedUpgrades.includes(u.id) || money < u.cost} 
                                                    onClick={() => { setMoney(m=>m-u.cost); setOwnedUpgrades(p=>[...p, u.id]); addLog(`${u.name} Â∞éÂÖ•ÔºÅ`, 'success'); }}
                                                    className={`p-4 border-2 text-left transition ${ownedUpgrades.includes(u.id)?'bg-emerald-50 border-emerald-200':'bg-white hover:border-amber-400'}`}>
                                                    <p className="font-bold text-sm">{u.name}</p>
                                                    <p className="text-[10px] opacity-60 mt-1">{u.description}</p>
                                                    <p className="mt-4 font-cinzel text-xs font-bold">{ownedUpgrades.includes(u.id)?'INSTALLED':`G ${u.cost}`}</p>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </main>

                    {/* Â±•Ê≠¥„É≠„Ç∞ */}
                    <aside className="w-80 bg-[#efe2d0] border-l-4 border-[#3e2723] flex flex-col">
                        <div className="p-6 bg-[#3e2723] text-amber-100 font-cinzel font-bold text-sm tracking-widest uppercase flex items-center gap-2">
                             Chronicle
                        </div>
                        <div className="flex-1 overflow-y-auto p-6 space-y-4 custom-scrollbar bg-[#f4ece1]/50 text-xs">
                            {logs.map(log => (
                                <div key={log.id} className="border-b border-black/5 pb-2 animate-in">
                                    <div className="flex justify-between opacity-40 text-[9px] mb-1"><span>{log.time}</span></div>
                                    <p className={`${log.type==='error'?'text-red-600':log.type==='success'?'text-emerald-700':''}`}>{log.msg}</p>
                                </div>
                            ))}
                        </div>
                    </aside>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
