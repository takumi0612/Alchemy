<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alchemy Atelier</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Quattrocento:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .font-cinzel { font-family: 'Cinzel', serif; }
        body { font-family: 'Quattrocento', serif; background-color: #f4ece1; margin: 0; overflow: hidden; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d7ccc8; border-radius: 10px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        const { 
            FlaskConical, Sparkles, Coins, Scroll, ShoppingBag, 
            Wand2, FlameKindling, History, TrendingUp, 
            ArrowRightLeft, Skull, Leaf, ShieldAlert, ChevronRight, User 
        } = lucide;

        // --- „Éá„Éº„ÇøÂÆöÁæ© ---
        const RAW_MATERIALS = [
            { id: 'red_herb', name: 'Ëµ§„ÅÆËñ¨Ëçâ', basePrice: 40, icon: 'üåø' },
            { id: 'blue_herb', name: 'Èùí„ÅÆËñ¨Ëçâ', basePrice: 60, icon: 'üå±' },
            { id: 'monster_claw', name: 'È≠îÁâ©„ÅÆÁà™', basePrice: 150, icon: 'ü¶¥' },
            { id: 'magic_water', name: 'È≠îÂäõÊ∞¥', basePrice: 100, icon: 'üíß' },
        ];

        const CRAFTED_ITEMS = [
            { id: 'hp_potion', name: 'Áôí„ÇÑ„Åó„ÅÆ„Éù„Éº„Ç∑„Éß„É≥', sellPrice: 250, icon: 'üß™', recipe: { red_herb: 2, magic_water: 1 }, description: 'ÂÇ∑„ÇíÁôí„ÇÑ„ÅôÂü∫Êú¨„ÅÆËñ¨„ÄÇ' },
            { id: 'mp_potion', name: 'È≠îÂäõ„ÅÆ„Éù„Éº„Ç∑„Éß„É≥', sellPrice: 350, icon: '‚öóÔ∏è', recipe: { blue_herb: 2, magic_water: 1 }, description: 'È≠îÂäõ„ÇíÂõûÂæ©„Åï„Åõ„ÇãÈùí„ÅÑÈõ´„ÄÇ' },
            { id: 'strength_elixir', name: 'ÂâõÂäõ„ÅÆÈúäËñ¨', sellPrice: 800, icon: 'üç∑', recipe: { monster_claw: 1, red_herb: 1, magic_water: 1 }, description: '‰∏ÄÊôÇÁöÑ„Å´Á≠ãÂäõ„ÇíÂ§ßÂπÖ„Å´Âº∑Âåñ„Åô„Çã„ÄÇ' },
        ];

        // --- „É°„Ç§„É≥„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà ---
        function App() {
            const [money, setMoney] = useState(1000);
            const [day, setDay] = useState(1);
            const [inventory, setInventory] = useState({ red_herb: 8, blue_herb: 5, monster_claw: 0, magic_water: 6, hp_potion: 0, mp_potion: 0, strength_elixir: 0 });
            const [marketPrices, setMarketPrices] = useState({});
            const [logs, setLogs] = useState([]);
            const [activeTab, setActiveTab] = useState('shop');
            const [reputation, setReputation] = useState(30);
            const [customerQueue, setCustomerQueue] = useState([]);
            const [stats, setStats] = useState({ totalSales: 0, craftedCount: 0 });

            useEffect(() => {
                const newPrices = {};
                RAW_MATERIALS.forEach(item => {
                    newPrices[item.id] = Math.floor(item.basePrice * (0.7 + Math.random() * 0.6));
                });
                setMarketPrices(newPrices);
            }, [day]);

            const addLog = (msg, type = 'info') => {
                setLogs(prev => [{ id: Date.now(), msg, type, time: new Date().toLocaleTimeString() }, ...prev].slice(0, 20));
            };

            const handleBuy = (itemId, amount) => {
                const cost = marketPrices[itemId] * amount;
                if (money >= cost) {
                    setMoney(m => m - cost);
                    setInventory(prev => ({ ...prev, [itemId]: prev[itemId] + amount }));
                    addLog(`${RAW_MATERIALS.find(i => i.id === itemId).name} √ó${amount} „Çí‰ªïÂÖ•„Çå„ÄÇ`, 'success');
                }
            };

            const handleCraft = (potionId) => {
                const potion = CRAFTED_ITEMS.find(p => p.id === potionId);
                const canCraft = Object.entries(potion.recipe).every(([id, count]) => inventory[id] >= count);
                if (canCraft) {
                    const newInv = { ...inventory };
                    Object.entries(potion.recipe).forEach(([id, count]) => newInv[id] -= count);
                    newInv[potionId] += 1;
                    setInventory(newInv);
                    setStats(s => ({ ...s, craftedCount: s.craftedCount + 1 }));
                    addLog(`${potion.name} „ÇíË™øÂêà„Åó„Åæ„Åó„ÅüÔºÅ`, 'success');
                }
            };

            // Á∞°ÊòìÁöÑ„Å™Ë≤©Â£≤„É≠„Ç∏„ÉÉ„ÇØ
            useEffect(() => {
                const timer = setInterval(() => {
                    if (Math.random() < 0.3) {
                        const all = [...RAW_MATERIALS, ...CRAFTED_ITEMS];
                        const item = all[Math.floor(Math.random() * all.length)];
                        if (inventory[item.id] > 0) {
                            const price = item.sellPrice || Math.floor(item.basePrice * 1.5);
                            setInventory(prev => ({ ...prev, [item.id]: prev[item.id] - 1 }));
                            setMoney(m => m + price);
                            setStats(s => ({ ...s, totalSales: s.totalSales + price }));
                            addLog(`Êù•ÂÆ¢Ôºö${item.name} „ÇíÈáëË≤®${price}Êûö„ÅßË≤©Â£≤„ÄÇ`, 'success');
                        }
                    }
                }, 5000);
                return () => clearInterval(timer);
            }, [inventory]);

            return (
                <div className="flex h-screen w-full overflow-hidden text-[#3e2723]">
                    {/* „Çµ„Ç§„Éâ„Éê„Éº */}
                    <aside className="w-64 bg-[#efe2d0] border-r-4 border-[#3e2723] flex flex-col p-6 shadow-xl">
                        <h1 className="text-2xl font-black font-cinzel text-amber-900 mb-8 text-center border-b-2 border-amber-900/10 pb-4">ALCHEMY</h1>
                        <nav className="flex-1 space-y-2">
                            {['shop', 'market', 'alchemy', 'stats'].map(tab => (
                                <button key={tab} onClick={() => setActiveTab(tab)} 
                                    className={`w-full text-left px-4 py-3 font-cinzel font-bold text-sm tracking-widest transition-all ${activeTab === tab ? 'bg-amber-900 text-white shadow-lg' : 'hover:bg-amber-800/10'}`}>
                                    {tab.toUpperCase()}
                                </button>
                            ))}
                        </nav>
                        <div className="mt-auto p-4 bg-white/50 rounded shadow-inner">
                            <div className="flex items-center gap-2 text-amber-700 font-bold">
                                <span className="text-xl">üí∞</span> {money}
                            </div>
                        </div>
                    </aside>

                    {/* „É°„Ç§„É≥ÁîªÈù¢ */}
                    <main className="flex-1 bg-[#fdfaf6] flex flex-col">
                        <header className="h-20 border-b-2 border-[#3e2723]/10 flex items-center justify-between px-10">
                            <div className="font-cinzel font-bold text-xl">DAY {day}</div>
                            <button onClick={() => setDay(d => d + 1)} className="bg-amber-900 text-white px-6 py-2 font-cinzel hover:bg-black transition-all">Next Day</button>
                        </header>

                        <div className="flex-1 p-10 overflow-y-auto custom-scrollbar">
                            {activeTab === 'shop' && (
                                <div className="animate-in grid grid-cols-2 md:grid-cols-3 gap-6">
                                    {[...RAW_MATERIALS, ...CRAFTED_ITEMS].map(item => (
                                        <div key={item.id} className="bg-white border-2 border-amber-100 p-6 shadow hover:border-amber-400 transition-all">
                                            <div className="text-4xl mb-2">{item.icon}</div>
                                            <div className="text-xs text-gray-400 uppercase font-bold">{item.name}</div>
                                            <div className="text-2xl font-cinzel font-black">{inventory[item.id] || 0}</div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {activeTab === 'market' && (
                                <div className="animate-in space-y-4">
                                    <h2 className="text-2xl font-cinzel font-bold mb-6">Market</h2>
                                    {RAW_MATERIALS.map(item => (
                                        <div key={item.id} className="bg-white p-6 border-2 border-amber-50 flex justify-between items-center shadow-sm">
                                            <div className="flex items-center gap-4">
                                                <span className="text-4xl">{item.icon}</span>
                                                <div className="font-bold text-lg">{item.name} (‰æ°Ê†º: {marketPrices[item.id]})</div>
                                            </div>
                                            <div className="flex gap-2">
                                                <button onClick={() => handleBuy(item.id, 1)} className="bg-amber-100 px-4 py-2 hover:bg-amber-200">1Ë≤∑</button>
                                                <button onClick={() => handleBuy(item.id, 10)} className="bg-amber-900 text-white px-4 py-2 hover:bg-black">10Ë≤∑</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {activeTab === 'alchemy' && (
                                <div className="animate-in space-y-6">
                                    <h2 className="text-2xl font-cinzel font-bold mb-6">Alchemy Cauldron</h2>
                                    {CRAFTED_ITEMS.map(potion => (
                                        <div key={potion.id} className="bg-white p-6 border-2 border-indigo-100 shadow-lg flex justify-between items-center">
                                            <div className="flex items-center gap-4">
                                                <span className="text-5xl">{potion.icon}</span>
                                                <div>
                                                    <div className="font-bold text-xl font-cinzel">{potion.name}</div>
                                                    <div className="text-xs text-gray-500">{potion.description}</div>
                                                </div>
                                            </div>
                                            <button onClick={() => handleCraft(potion.id)} className="bg-indigo-900 text-white px-8 py-3 font-cinzel hover:bg-indigo-700">Ë™øÂêà</button>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {activeTab === 'stats' && (
                                <div className="animate-in grid grid-cols-2 gap-8">
                                    <div className="bg-white p-10 border-2 border-amber-100 shadow-xl text-center">
                                        <div className="text-sm uppercase text-gray-400">Total Revenue</div>
                                        <div className="text-5xl font-cinzel font-black mt-2">üí∞ {stats.totalSales}</div>
                                    </div>
                                    <div className="bg-white p-10 border-2 border-indigo-100 shadow-xl text-center">
                                        <div className="text-sm uppercase text-gray-400">Crafted</div>
                                        <div className="text-5xl font-cinzel font-black mt-2">üß™ {stats.craftedCount}</div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </main>

                    {/* „É≠„Ç∞ */}
                    <aside className="w-80 bg-[#efe2d0] border-l-4 border-[#3e2723] flex flex-col p-6 overflow-hidden">
                        <h3 className="font-cinzel font-bold text-sm tracking-widest mb-4 border-b border-black/10 pb-2">CHRONICLE</h3>
                        <div className="flex-1 overflow-y-auto space-y-3 custom-scrollbar">
                            {logs.map(log => (
                                <div key={log.id} className="text-sm border-b border-black/5 pb-2">
                                    <div className="text-[10px] text-amber-800/50">{log.time}</div>
                                    <div className={log.type === 'success' ? 'text-green-700 font-bold' : ''}>{log.msg}</div>
                                </div>
                            ))}
                        </div>
                    </aside>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
